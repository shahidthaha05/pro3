<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ game.title }} - Slots</title>
    <style>
        .slot-list { margin-top: 20px; }
        .slot-item { font-size: 16px; margin-bottom: 10px; }
        .available { color: green; font-weight: bold; }
        .booked { color: red; font-weight: bold; }
        .button { padding: 10px 20px; background-color: #4CAF50; color: white; border: none; cursor: pointer; }
        .button:disabled { background-color: gray; cursor: not-allowed; }
    </style>
    <script>
        function checkSlotAvailability() {
            let selectedSlot = document.getElementById("slot").value;
            let bookedSlots = JSON.parse('{{ booked_slots_json|safe }}');

            if (bookedSlots.includes(selectedSlot)) {
                alert("This time slot is already booked. Please select another.");
                return false;
            }
            return true;
        }
    </script>
</head>
<body>

<h2>{{ game.title }} - Available Slots</h2>

<!-- Date Picker -->
<form method="GET">
    <label for="date">Select Date:</label>
    <input type="date" name="date" id="date" value="{{ selected_date }}" onchange="this.form.submit()">
</form>

<!-- Available Slots -->
<div class="slot-list">
    <h3>Slots for {{ selected_date }}:</h3>
    {% if available_slots or booked_slots %}
        <ul>
            {% for slot in available_slots %}
                <li class="slot-item">
                    <span>{{ slot.time_slot }}</span>
                    <span class="available">Available</span>
                </li>
            {% endfor %}
            {% for slot in booked_slots %}
                <li class="slot-item">
                    <span>{{ slot.time_slot }}</span>
                    <span class="booked">Booked</span>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No slots available.</p>
    {% endif %}
</div>

<!-- Booking Form -->
{% if available_slots %}
    <form method="POST" action="{% url 'book_slot' game_id=game.id %}" onsubmit="return checkSlotAvailability()">
        {% csrf_token %}
        <label for="slot">Select a Slot:</label>
        <select name="slot_id" id="slot" required>
            {% for slot in available_slots %}
                <option value="{{ slot.id }}">{{ slot.time_slot }}</option>
            {% endfor %}
        </select>
        <input type="hidden" name="date" value="{{ selected_date }}">
        <input type="text" name="name" placeholder="Your Name" required>
        <input type="email" name="email" placeholder="Your Email" required>
        <button type="submit" class="button">Book Now</button>
    </form>
{% else %}
    <p>No available slots.</p>
{% endif %}

</body>
</html>
